var Shisa=function(){'use strict';function a(a,c){var d=Math.max,e=Math.min;const g="data-speed";a.classList.add("shisa-speed"),c.on("ratechange",()=>{a.setAttribute(g,c.speed),a.textContent=b(c.speed)+"x"});const h={min:a.getAttribute(`${"data-speed"}-min`),max:a.getAttribute(`${"data-speed"}-max`),step:a.getAttribute(`${"data-speed"}-step`)},i=Object.keys(h).reduce((b,c)=>(b[c]=h[c]&&!isNaN(+h[c])?+h[c]:f[c],h[c]!==b[c]&&a.setAttribute(`${g}-${c}`,b[c]),b),{});let j=a.getAttribute("data-speed");j&&"number"==typeof+j||0===j||(j=c.audio.defaultPlaybackRate),c.speed=d(i.min,e(j,i.max)),a.textContent=b(c.speed)+"x",a.addEventListener("click",()=>{c.speed=c.speed>=i.max?i.min:e(i.max,d(i.min,c.speed+i.step))})}function b(a){const b=parseFloat(a).toFixed(2);return"0"===b.slice(-1)?b.slice(0,-1):b}function c(a){var b=Math.floor,c=Math.round;a=c(a);let d=b(a/3600),e=b((a-3600*d)/60),f=b(a-3600*d-60*e);return e=10>e?"0"+e:e,f=10>f?"0"+f:f,0===d?(d=10>d?"0"+d:d,`${e}:${f}`):`${d}:${e}:${f}`}function d(a,b){a.style.width=`${100*b}%`,a.setAttribute("aria-valuenow",b)}class e{constructor(){this.audioEvents=["abort","canplay","canplaythrough","complete","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],this.events={}}on(a,b){this.audioEvents.includes(a)&&"function"==typeof b?!this.events[a]&&(this.events[a]=[]):console.error("invalid event name or callback function"),this.events[a].push(b)}trigger(a,b={}){this.events[a]&&this.events[a].length&&this.events[a].forEach(a=>a(b))}}const f={min:.25,max:5,step:.25},g={forward:15,backward:15},h={play:function(a,b){function c(){b.audio.paused?b.play():b.pause()}const d="data-play";a.classList.add("shisa-play"),a.addEventListener("click",()=>c()),b.on("play",()=>{a.setAttribute(d,"play"),b.el.classList.add("Playing"),b.el.classList.remove("Paused")}),b.on("pause",()=>{a.setAttribute(d,"pause"),b.el.classList.add("Paused"),b.el.classList.remove("Playing")})},mute:function(a,b){const c="data-muted";a.classList.add("shisa-mute");let d=a.getAttribute("data-muted");""===d&&(b.muted=!0,b.el.classList.add("Muted")),a.addEventListener("click",()=>{b.muted=!b.muted,b.muted?a.setAttribute(c,""):a.removeAttribute(c),b.el.classList.toggle("Muted")})},speed:a,spinner:function(a,b){const c="data-buffering";a.classList.add("shisa-spinner"),b.on("canplaythrough",()=>{a.removeAttribute(c),b.el.classList.remove("Spinning")}),b.on("waiting",()=>{a.setAttribute(c,""),b.el.classList.add("Spinning")}),b.on("seeking",()=>{a.setAttribute(c,""),b.el.classList.add("Spinning")})},time:function(a,b){a.classList.add("shisa-time");const d=Array.from(a.attributes).find(a=>/data-time-/.test(a.name));if(d){const e=d.name.slice(10);"current"===e?(d.value=a.textContent=c(b.currentTime),a.classList.add("shisa-time_current"),b.on("timeupdate",()=>{d.value=a.textContent=c(b.currentTime)})):"duration"===e&&(d.value=a.textContent="--:--",a.classList.add("shisa-time_duration"),b.on("loadedmetadata",()=>{b.metadataIsFetched&&b.duration&&(d.value=a.textContent=c(b.duration))}),b.on("durationchange",()=>{-1!==b.duration&&(d.value=a.textContent=c(b.duration))}))}},seek:function(a,b){a.classList.add("shisa-seek");const c=Array.from(a.attributes).find(a=>/data-seek-/.test(a.name));if(!c)return;const d=c.name.slice(10);let e=c.value;("forward"===d||"backward"===d)&&(e=e&&!isNaN(+e)?+e:g[d],c.value=e,e="forward"===d?e:-e,a.addEventListener("click",()=>{b.seek(b.currentTime+e)}))},progress:function(a,b){const c={buffer:null,play:null};a.classList.add("shisa-progress"),Object.keys(c).forEach(b=>{c[b]=document.createElement("div"),c[b].classList.add(`shisa-progress_${b}`),c[b].setAttribute("aria-role","progressbar"),c[b].setAttribute("aria-readonly",""),c[b].setAttribute("aria-valuemin",0),c[b].setAttribute("aria-valuemax",1),a.append(c[b]),d(c[b],0)}),b.on("progress",()=>{if(b.metadataIsFetched&&b.duration){const a=b.audio.buffered.length?b.audio.buffered.end(b.audio.buffered.length-1)/b.duration:0;d(c.buffer,a)}}),b.on("loadedmetadata",()=>{if(b.metadataIsFetched&&b.duration){const a=b.audio.currentTime/b.duration;d(c.play,a)}}),b.on("timeupdate",()=>{if(b.metadataIsFetched&&b.duration){const a=b.audio.currentTime/b.duration;d(c.play,a)}}),b.on("ended",()=>{b.audio.currentTime=0});let e=null,f=!1;const g=document.createElement("input");g.setAttribute(`${"data-progress"}-slider`,""),g.classList.add("shisa-progress_slider"),a.append(g),g.type="range",g.min=0,g.max=100,g.value=0,g.step=.01,g.addEventListener("input",()=>{f||(f=!0)}),g.addEventListener("change",()=>{f&&(f=!1),b.metadataIsFetched&&b.duration?(b.seek(g.value/g.max*b.duration),g.setAttribute("value",g.value)):e=g.value}),b.on("canplay",()=>{e&&b.duration&&(b.seek(e/g.max*b.duration),e=null)}),b.on("timeupdate",()=>{f||(g.value=b.currentTime/b.duration*g.max,g.setAttribute("value",g.value))})}},i={},j={preload:"metadata",autoplay:!1,defaultMuted:!1,defaultPlaybackRate:"1.0"};class k{constructor(a,b,c={}){this.el=a,this.el.classList.add("shisa"),this.events=new e,this.audio=new Audio,Object.assign(this.audio,j,c),this.audio.src=b,this.el.classList.add("shisa_ready"),this.metadataIsFetched=!1;const d=this.el.querySelectorAll("[data-shisa]");for(let e=0;e<d.length;e++)this._renderComponent(d[e],this.audio);this._initEvents(),this.events.audioEvents.forEach(a=>{this.audio.addEventListener(a,b=>{this.events.trigger(a,b)})})}_renderComponent(a){const b=a.getAttribute("data-shisa"),c=h[b]||i[b];c&&c(a,this)}_initEvents(){this.on("loadedmetadata",()=>{this.metadataIsFetched=!0})}on(a,b){this.events.on(a,b)}get currentTime(){return this.audio.currentTime}set currentTime(a){this.audio.currentTime=a}get duration(){return this.audio.duration}get muted(){return this.audio.muted}set muted(a){this.audio.muted=a}get speed(){return this.audio.playbackRate}set speed(a){a&&"number"==typeof+a&&(this.audio.playbackRate=+a)}seek(a){if(a=parseInt(a),isNaN(a)||!isFinite(a))throw new Error("Seeking time is not a valid number.");else this.currentTime=a}play(a){if(a&&(this.audio.src=a),!!this.audio.paused){const a=this.audio.play();void 0!==a&&a.catch(a=>{("NotAllowedError"===a.name||"NotSupportedError"===a.name)&&this.pause()})}}pause(){this.audio.paused||this.audio.pause()}destroy(){this.audio.pause(),this.audio.src="",this.audio.load(),this.audio=null}}return k.register=function(a,b){i[a]=b},window.Shisa=k,console.log(`%c Built w/Shisa Podcast Player v0.0.1 %c https://jessuni.github.io/shisa/`,"color:#555;padding:4px 0","padding: 2px 0;"),k}();
